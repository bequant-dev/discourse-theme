<!-- BeQuant Theme Header -->
<!-- This file will be automatically included in all Discourse pages -->

<!-- Custom CSS for BeQuant Theme -->
<style>
/* BeQuant Theme CSS Variables and Base Styles */
:root {
  /* BeQuant Color Palette - Softer for light mode */
--bequant-primary: #3b82f6;        /* Blue-500 - softer than Indigo-600 */
--bequant-primary-dark: #0f172a;   /* Slate-900 */
--bequant-primary-light: #38bdf8;  /* Teal-400 */
  
  /* Light Mode Colors - Material Design 3 Palette */
--bequant-bg: #fafafa;              /* Material Grey 50 */
--bequant-surface: #ffffff;         /* Material White */
--bequant-surface-variant: #f5f5f5; /* Material Grey 100 */
--bequant-border: #e0e0e0;          /* Material Grey 300 */
--bequant-text: #212121;            /* Material Grey 900 */
--bequant-text-secondary: #757575;  /* Material Grey 600 */
--bequant-text-tertiary: #9e9e9e;   /* Material Grey 500 */
--bequant-primary: #1976d2;         /* Material Blue 700 */
--bequant-primary-light: #42a5f5;   /* Material Blue 400 */
--bequant-primary-dark: #1565c0;    /* Material Blue 800 */
--bequant-on-primary: #ffffff;      /* White text on primary */
--bequant-secondary: #f5f5f5;       /* Material Grey 100 */
--bequant-on-secondary: #212121;    /* Dark text on secondary */
--bequant-error: #d32f2f;           /* Material Red 700 */
--bequant-success: #388e3c;         /* Material Green 700 */
--bequant-warning: #f57c00;         /* Material Orange 700 */
--bequant-info: #0288d1;            /* Material Light Blue 700 */
--bequant-gray-50: #fafafa;
--bequant-gray-100: #f5f5f5;
--bequant-gray-200: #eeeeee;
--bequant-gray-300: #e0e0e0;
--bequant-gray-400: #bdbdbd;
--bequant-gray-500: #9e9e9e;
--bequant-gray-600: #757575;
--bequant-gray-700: #616161;
--bequant-gray-800: #424242;
--bequant-gray-900: #212121;
--bequant-gray-950: #212121;
  --bequant-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
}

/* Dark Mode Colors - Exact from bequant.dev */
[data-theme="dark"] {
  --bequant-bg: #0f172a;              /* Gray-950 background */
  --bequant-surface: #1f2937;         /* Gray-800 surface */
  --bequant-border: #374151;          /* Gray-700 border */
  --bequant-text: #f9fafb;            /* Gray-50 text */
  --bequant-text-secondary: #9ca3af;  /* Gray-400 secondary text */
  --bequant-gray-50: #f9fafb;         /* Gray-50 */
  --bequant-gray-100: #f3f4f6;        /* Gray-100 */
  --bequant-gray-200: #e5e7eb;        /* Gray-200 */
  --bequant-gray-700: #374151;        /* Gray-700 */
  --bequant-gray-800: #1f2937;        /* Gray-800 */
  --bequant-gray-900: #111827;        /* Gray-900 */
  --bequant-gray-950: #0f172a;        /* Gray-950 */
  --bequant-primary: #38bdf8;         /* Teal-400 in dark mode */
  --bequant-primary-light: #2563eb;   /* Indigo-600 in dark mode */
  --bequant-primary-dark: #0f172a;    /* Gray-950 in dark mode */
  --bequant-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
}

/* Global Theme Styles */
body {
  background-color: var(--bequant-bg) !important;
  color: var(--bequant-text) !important;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Header Styling - Exact BeQuant.dev design */
.d-header {
  background-color: var(--bequant-bg) !important;
  border-bottom: 1px solid var(--bequant-border) !important;
  box-shadow: none !important;
  padding: 0.5rem 1rem !important;
}

/* Dark mode header - Exact BeQuant.dev styling */
[data-theme="dark"] .d-header {
  background-color: var(--bequant-gray-950) !important;
  border-bottom: 1px solid var(--bequant-gray-800) !important;
}

/* Site title/logo styling */
.d-header .title {
  color: var(--bequant-primary) !important;
  font-weight: bold !important;
  font-size: 1.5rem !important;
  text-decoration: none !important;
}

.d-header .title:hover {
  color: var(--bequant-primary-light) !important;
}

/* Header navigation links - Exact BeQuant.dev styling */
.d-header .header-links a {
  color: var(--bequant-text) !important;
  font-weight: 400 !important;
  transition: color 0.2s ease !important;
  margin-left: 2rem !important;
  text-decoration: none !important;
  font-size: 0.875rem !important;
}

.d-header .header-links a:hover {
  text-decoration: underline !important;
}

/* Header buttons styling - Exact BeQuant.dev styling */
.d-header .header-buttons .btn {
  background-color: transparent !important;
  color: var(--bequant-text) !important;
  border: none !important;
  border-radius: 0.5rem !important;
  padding: 0.25rem !important;
  font-weight: 400 !important;
  transition: all 0.2s ease !important;
  margin-left: 0.75rem !important;
}

.d-header .header-buttons .btn:hover {
  background-color: var(--bequant-gray-100) !important;
  transform: none !important;
}

/* Dark mode button hover */
[data-theme="dark"] .d-header .header-buttons .btn:hover {
  background-color: var(--bequant-gray-800) !important;
}

/* Theme toggle button in header - Exact BeQuant.dev styling */
.d-header .bequant-theme-toggle {
  position: static !important;
  background-color: transparent !important;
  color: var(--bequant-text) !important;
  border: none !important;
  border-radius: 0.5rem !important;
  width: auto !important;
  height: auto !important;
  padding: 0.25rem !important;
  margin-left: 0.75rem !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
  box-shadow: none !important;
  font-size: 1rem !important;
}

.d-header .bequant-theme-toggle:hover {
  background-color: var(--bequant-gray-100) !important;
  transform: none !important;
}

/* Dark mode theme toggle hover */
[data-theme="dark"] .d-header .bequant-theme-toggle:hover {
  background-color: var(--bequant-gray-800) !important;
}

.d-header .bequant-theme-toggle svg {
  width: 1.25rem !important;
  height: 1.25rem !important;
}

/* Navigation */
.nav-pills .nav-item a {
  color: var(--bequant-text-secondary) !important;
  border-radius: 0.5rem !important;
  transition: all 0.2s ease !important;
}

.nav-pills .nav-item a:hover {
  color: var(--bequant-primary) !important;
  background-color: rgba(37, 99, 235, 0.1) !important;
}

.nav-pills .nav-item a.active {
  background-color: var(--bequant-primary) !important;
  color: white !important;
}

/* Topic List */
.topic-list .topic-list-item {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.75rem !important;
  margin-bottom: 0.75rem !important;
  transition: all 0.2s ease !important;
}

.topic-list .topic-list-item:hover {
  transform: translateY(-2px) !important;
  box-shadow: var(--bequant-shadow) !important;
}

.topic-list .topic-list-item .main-link .title {
  color: var(--bequant-text) !important;
  font-weight: 600 !important;
}

.topic-list .topic-list-item .main-link .title:hover {
  color: var(--bequant-primary) !important;
}

.topic-list .topic-list-item .num {
  color: var(--bequant-text-secondary) !important;
}

/* Topic View */
.topic-post {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.75rem !important;
  margin-bottom: 1rem !important;
}

.topic-post .cooked {
  color: var(--bequant-text) !important;
  line-height: 1.6 !important;
}

.topic-post .post-info {
  color: var(--bequant-text-secondary) !important;
}

/* Buttons */
.btn {
  border-radius: 0.5rem !important;
  font-weight: 600 !important;
  transition: all 0.2s ease !important;
}

.btn.btn-primary {
  background-color: var(--bequant-primary) !important;
  border-color: var(--bequant-primary) !important;
}

.btn.btn-primary:hover {
  background-color: var(--bequant-primary-light) !important;
  border-color: var(--bequant-primary-light) !important;
  transform: translateY(-1px) !important;
}

.btn.btn-danger {
  background-color: #ef4444 !important;
  border-color: #ef4444 !important;
}

.btn.btn-danger:hover {
  background-color: #dc2626 !important;
  border-color: #dc2626 !important;
}

/* Forms */
.form-control {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.5rem !important;
  color: var(--bequant-text) !important;
}

.form-control:focus {
  border-color: var(--bequant-primary) !important;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1) !important;
}

/* Sidebar */
.sidebar-section {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.75rem !important;
  margin-bottom: 1rem !important;
}

.sidebar-section .sidebar-section-header {
  color: var(--bequant-text) !important;
  font-weight: 600 !important;
  border-bottom: 1px solid var(--bequant-border) !important;
}

.sidebar-section .sidebar-section-content {
  color: var(--bequant-text-secondary) !important;
}

/* Code Blocks */
pre {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.5rem !important;
  color: var(--bequant-text) !important;
}

code {
  background-color: rgba(37, 99, 235, 0.1) !important;
  color: var(--bequant-primary) !important;
  border-radius: 0.25rem !important;
  padding: 0.125rem 0.25rem !important;
}

/* Links */
a {
  color: var(--bequant-primary) !important;
  transition: color 0.2s ease !important;
}

a:hover {
  color: var(--bequant-primary-light) !important;
}

/* Theme Toggle Button - Now in header */
.bequant-theme-toggle {
  background-color: transparent !important;
  color: var(--bequant-text) !important;
  border: none !important;
  border-radius: 0.5rem !important;
  padding: 0.5rem !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
  font-size: 1rem !important;
}

.bequant-theme-toggle:hover {
  background-color: rgba(255, 255, 255, 0.1) !important;
}

.bequant-theme-toggle svg {
  width: 1.25rem !important;
  height: 1.25rem !important;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px !important;
}

::-webkit-scrollbar-track {
  background: var(--bequant-surface) !important;
}

::-webkit-scrollbar-thumb {
  background: var(--bequant-border) !important;
  border-radius: 4px !important;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--bequant-text-secondary) !important;
}

/* Additional Discourse-specific overrides */
#main-outlet {
  background-color: var(--bequant-bg) !important;
}

.list-controls {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.75rem !important;
}

.category-box {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.75rem !important;
}

.category-box:hover {
  transform: translateY(-2px) !important;
  box-shadow: var(--bequant-shadow) !important;
}

/* Light Theme Improvements - Softer, more pleasant design */
body {
  background-color: var(--bequant-bg) !important;
  color: var(--bequant-text) !important;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Main content area - softer background */
#main-outlet {
  background-color: var(--bequant-bg) !important;
}

/* Sidebar - Light theme styling */
.sidebar-section {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.75rem !important;
  margin-bottom: 1rem !important;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
}

/* Fix sidebar background in light mode */
#main-outlet .sidebar,
.sidebar {
  background-color: var(--bequant-surface) !important;
  border-right: 1px solid var(--bequant-border) !important;
}

/* Force sidebar to be light in light mode */
[data-theme="light"] .sidebar,
[data-theme="light"] #main-outlet .sidebar {
  background-color: var(--bequant-surface) !important;
  color: var(--bequant-text) !important;
}

/* Override any dark sidebar styling */
.sidebar,
#main-outlet .sidebar,
.d-sidebar {
  background-color: var(--bequant-surface) !important;
  color: var(--bequant-text) !important;
}

/* Fix category and tag buttons */
.nav-pills .nav-item .btn,
.nav-pills .nav-item button,
.nav-pills .nav-item a {
  color: var(--bequant-text) !important;
  background-color: transparent !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.5rem !important;
  padding: 0.5rem 1rem !important;
  margin-right: 0.5rem !important;
  font-weight: 500 !important;
  transition: all 0.2s ease !important;
}

.nav-pills .nav-item .btn:hover,
.nav-pills .nav-item button:hover,
.nav-pills .nav-item a:hover {
  color: var(--bequant-primary) !important;
  background-color: rgba(59, 130, 246, 0.05) !important;
  border-color: var(--bequant-primary) !important;
}

/* Fix sidebar navigation */
#main-outlet .sidebar .sidebar-section,
.sidebar .sidebar-section {
  background-color: transparent !important;
  border: none !important;
  box-shadow: none !important;
  color: var(--bequant-text) !important;
}

/* Force all sidebar elements to be light */
.sidebar *,
#main-outlet .sidebar * {
  color: var(--bequant-text) !important;
}

.sidebar a,
#main-outlet .sidebar a {
  color: var(--bequant-text) !important;
}

.sidebar a:hover,
#main-outlet .sidebar a:hover {
  color: var(--bequant-primary) !important;
}

/* Material Design Sidebar Selection States */
.sidebar .sidebar-section-content a,
.sidebar .sidebar-section-content .sidebar-section-link,
.sidebar .sidebar-section-content .sidebar-section-link-wrapper {
  color: var(--bequant-text) !important;
  background-color: transparent !important;
  border-radius: 0.5rem !important;
  padding: 0.75rem 1rem !important;
  margin: 0.125rem 0 !important;
  transition: all 0.2s ease !important;
  text-decoration: none !important;
  display: block !important;
}

.sidebar .sidebar-section-content a:hover,
.sidebar .sidebar-section-content .sidebar-section-link:hover,
.sidebar .sidebar-section-content .sidebar-section-link-wrapper:hover {
  background-color: var(--bequant-secondary) !important;
  color: var(--bequant-primary) !important;
}

/* Selected state - Material Design elevation */
.sidebar .sidebar-section-content a.active,
.sidebar .sidebar-section-content .sidebar-section-link.active,
.sidebar .sidebar-section-content .sidebar-section-link-wrapper.active,
.sidebar .sidebar-section-content a.selected,
.sidebar .sidebar-section-content .sidebar-section-link.selected,
.sidebar .sidebar-section-content .sidebar-section-link-wrapper.selected {
  background-color: var(--bequant-primary) !important;
  color: var(--bequant-on-primary) !important;
  box-shadow: 0 2px 4px -1px rgba(25, 118, 210, 0.2), 0 1px 2px 0 rgba(25, 118, 210, 0.14) !important;
  font-weight: 500 !important;
}

/* Admin panel sidebar selection */
.admin-controls .sidebar-section-content a,
.admin-controls .sidebar-section-content .sidebar-section-link {
  color: var(--bequant-text) !important;
  background-color: transparent !important;
  border-radius: 0.5rem !important;
  padding: 0.75rem 1rem !important;
  margin: 0.125rem 0 !important;
  transition: all 0.2s ease !important;
}

.admin-controls .sidebar-section-content a:hover,
.admin-controls .sidebar-section-content .sidebar-section-link:hover {
  background-color: var(--bequant-secondary) !important;
  color: var(--bequant-primary) !important;
}

.admin-controls .sidebar-section-content a.active,
.admin-controls .sidebar-section-content .sidebar-section-link.active {
  background-color: var(--bequant-primary) !important;
  color: var(--bequant-on-primary) !important;
  box-shadow: 0 2px 4px -1px rgba(25, 118, 210, 0.2), 0 1px 2px 0 rgba(25, 118, 210, 0.14) !important;
  font-weight: 500 !important;
}

#main-outlet .sidebar .sidebar-section-header {
  color: var(--bequant-text) !important;
  font-weight: 600 !important;
  border-bottom: 1px solid var(--bequant-border) !important;
  padding-bottom: 0.5rem !important;
  margin-bottom: 0.5rem !important;
}

#main-outlet .sidebar .sidebar-section-content {
  color: var(--bequant-text) !important;
}

#main-outlet .sidebar a {
  color: var(--bequant-text) !important;
  transition: color 0.2s ease !important;
}

#main-outlet .sidebar a:hover {
  color: var(--bequant-primary) !important;
}

.sidebar-section .sidebar-section-header {
  color: var(--bequant-text) !important;
  font-weight: 600 !important;
  border-bottom: 1px solid var(--bequant-border) !important;
}

.sidebar-section .sidebar-section-content {
  color: var(--bequant-text) !important;
}

/* Sidebar navigation items */
.sidebar-section a {
  color: var(--bequant-text) !important;
  transition: color 0.2s ease !important;
}

.sidebar-section a:hover {
  color: var(--bequant-primary) !important;
}

/* Fix grey text issues */
.nav-pills .nav-item a,
.sidebar-section a,
.header-links a {
  color: var(--bequant-text) !important;
}

.nav-pills .nav-item a:hover,
.sidebar-section a:hover,
.header-links a:hover {
  color: var(--bequant-primary) !important;
}

/* Fix specific grey text elements */
.sidebar-section .sidebar-section-content a,
.sidebar-section .sidebar-section-content span,
.sidebar-section .sidebar-section-content div {
  color: var(--bequant-text) !important;
}

/* Fix "More..." text and similar elements */
.sidebar-section .sidebar-section-content .more,
.sidebar-section .sidebar-section-content .more-link,
.sidebar-section .sidebar-section-content .more-link a {
  color: var(--bequant-text) !important;
}

/* Fix category text */
.category-box .category-box-inner .category-box-heading,
.category-box .category-box-inner .category-box-heading a {
  color: var(--bequant-text) !important;
}

/* Fix topic list text */
.topic-list .topic-list-item .main-link .title,
.topic-list .topic-list-item .main-link .blurb {
  color: var(--bequant-text) !important;
}

/* Fix navigation buttons and elements */
.nav-pills .nav-item a,
.nav-pills .nav-item button,
.nav-pills .nav-item .btn {
  color: var(--bequant-text) !important;
  background-color: transparent !important;
  border: none !important;
  font-weight: 500 !important;
}

.nav-pills .nav-item a:hover,
.nav-pills .nav-item button:hover,
.nav-pills .nav-item .btn:hover {
  color: var(--bequant-primary) !important;
  background-color: rgba(59, 130, 246, 0.05) !important;
}

.nav-pills .nav-item a.active,
.nav-pills .nav-item button.active,
.nav-pills .nav-item .btn.active {
  color: var(--bequant-primary) !important;
  background-color: rgba(59, 130, 246, 0.1) !important;
  border-bottom: 2px solid var(--bequant-primary) !important;
}

/* Fix "New Topic" button - Material Design */
.btn.btn-primary,
.btn-primary {
  background-color: var(--bequant-primary) !important;
  color: var(--bequant-on-primary) !important;
  border: none !important;
  border-radius: 0.5rem !important;
  padding: 0.75rem 1.5rem !important;
  font-weight: 500 !important;
  font-size: 0.875rem !important;
  text-transform: uppercase !important;
  letter-spacing: 0.025em !important;
  transition: all 0.2s ease !important;
  box-shadow: 0 2px 4px -1px rgba(25, 118, 210, 0.2), 0 1px 2px 0 rgba(25, 118, 210, 0.14) !important;
}

.btn.btn-primary:hover,
.btn-primary:hover {
  background-color: var(--bequant-primary-dark) !important;
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 8px -1px rgba(25, 118, 210, 0.3), 0 2px 4px 0 rgba(25, 118, 210, 0.2) !important;
}

.btn.btn-primary:active,
.btn-primary:active {
  transform: translateY(0) !important;
  box-shadow: 0 2px 4px -1px rgba(25, 118, 210, 0.2), 0 1px 2px 0 rgba(25, 118, 210, 0.14) !important;
}

/* Fix "Powered by Discourse" */
.footer-message,
.footer-message a {
  color: var(--bequant-text-secondary) !important;
  text-decoration: none !important;
}

.footer-message a:hover {
  color: var(--bequant-primary) !important;
}

/* Topic list improvements */
.topic-list .topic-list-item {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.75rem !important;
  margin-bottom: 0.75rem !important;
  transition: all 0.2s ease !important;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
}

.topic-list .topic-list-item:hover {
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important;
}

/* Navigation pills - better contrast */
.nav-pills .nav-item a {
  color: var(--bequant-text) !important;
  border-radius: 0.5rem !important;
  transition: all 0.2s ease !important;
  background-color: transparent !important;
  font-weight: 500 !important;
}

.nav-pills .nav-item a:hover {
  color: var(--bequant-primary) !important;
  background-color: rgba(59, 130, 246, 0.05) !important;
}

.nav-pills .nav-item a.active {
  background-color: var(--bequant-primary) !important;
  color: white !important;
}

/* Sidebar improvements */
.sidebar-section {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.75rem !important;
  margin-bottom: 1rem !important;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
}

/* Buttons - softer styling */
.btn {
  border-radius: 0.5rem !important;
  font-weight: 600 !important;
  transition: all 0.2s ease !important;
}

.btn.btn-primary {
  background-color: var(--bequant-primary) !important;
  border-color: var(--bequant-primary) !important;
  box-shadow: 0 1px 2px 0 rgba(37, 99, 235, 0.1) !important;
}

.btn.btn-primary:hover {
  background-color: var(--bequant-primary-light) !important;
  border-color: var(--bequant-primary-light) !important;
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2) !important;
}

/* Forms - softer styling */
.form-control {
  background-color: var(--bequant-surface) !important;
  border: 1px solid var(--bequant-border) !important;
  border-radius: 0.5rem !important;
  color: var(--bequant-text) !important;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
}

.form-control:focus {
  border-color: var(--bequant-primary) !important;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1) !important;
}

/* Ensure smooth transitions */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease !important;
}
</style>

<!-- Custom JavaScript for Theme Toggle -->
<script>
// BeQuant Theme Toggle for Discourse
(function() {
  'use strict';
  
  const ThemeManager = {
    STORAGE_KEY: 'bequant-theme',
    THEMES: { LIGHT: 'light', DARK: 'dark' },
    
    init() {
      this.loadTheme();
      this.createToggleButton();
      this.setupSystemThemeListener();
    },
    
    loadTheme() {
      const savedTheme = localStorage.getItem(this.STORAGE_KEY);
      const systemTheme = this.getSystemTheme();
      const theme = savedTheme || systemTheme;
      this.applyTheme(theme);
    },
    
    getSystemTheme() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches 
        ? this.THEMES.DARK 
        : this.THEMES.LIGHT;
    },
    
    applyTheme(theme) {
      const root = document.documentElement;
      if (theme === this.THEMES.DARK) {
        root.setAttribute('data-theme', 'dark');
        root.classList.add('dark-mode');
        root.classList.remove('light-mode');
      } else {
        root.setAttribute('data-theme', 'light');
        root.classList.add('light-mode');
        root.classList.remove('dark-mode');
      }
      localStorage.setItem(this.STORAGE_KEY, theme);
      this.updateToggleButton(theme);
    },
    
    toggleTheme() {
      const currentTheme = localStorage.getItem(this.STORAGE_KEY) || this.getSystemTheme();
      const newTheme = currentTheme === this.THEMES.LIGHT ? this.THEMES.DARK : this.THEMES.LIGHT;
      this.applyTheme(newTheme);
    },
    
    createToggleButton() {
      const existingButton = document.querySelector('.bequant-theme-toggle');
      if (existingButton) existingButton.remove();
      
      const button = document.createElement('button');
      button.className = 'bequant-theme-toggle';
      button.setAttribute('aria-label', 'Toggle theme');
      button.setAttribute('title', 'Toggle light/dark mode');
      button.innerHTML = this.getToggleIcon();
      
      button.addEventListener('click', () => this.toggleTheme());
      
      // Insert the button into the header, before the user avatar
      const headerButtons = document.querySelector('.d-header .header-buttons');
      if (headerButtons) {
        headerButtons.insertBefore(button, headerButtons.firstChild);
      } else {
        // Fallback: append to header
        const header = document.querySelector('.d-header');
        if (header) {
          header.appendChild(button);
        }
      }
      
      const currentTheme = localStorage.getItem(this.STORAGE_KEY) || this.getSystemTheme();
      this.updateToggleButton(currentTheme);
    },
    
    updateToggleButton(theme) {
      const button = document.querySelector('.bequant-theme-toggle');
      if (!button) return;
      button.innerHTML = this.getToggleIcon(theme);
      button.setAttribute('aria-label', `Switch to ${theme === 'light' ? 'dark' : 'light'} mode`);
    },
    
    getToggleIcon(theme) {
      const currentTheme = theme || localStorage.getItem(this.STORAGE_KEY) || this.getSystemTheme();
      
      if (currentTheme === this.THEMES.LIGHT) {
        return '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>';
      } else {
        return '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>';
      }
    },
    
    setupSystemThemeListener() {
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      mediaQuery.addEventListener('change', (e) => {
        if (!localStorage.getItem(this.STORAGE_KEY)) {
          const newTheme = e.matches ? this.THEMES.DARK : this.THEMES.LIGHT;
          this.applyTheme(newTheme);
        }
      });
    }
  };
  
  // Initialize when Discourse is ready
  const initTheme = () => {
    if (window.Discourse && document.querySelector('.d-header')) {
      setTimeout(() => ThemeManager.init(), 500);
    } else {
      setTimeout(initTheme, 100);
    }
  };
  
  if (document.readyState !== 'loading') {
    initTheme();
  } else {
    document.addEventListener('DOMContentLoaded', initTheme);
  }
})();
</script> 